version: 1

# 新增：预算阈值配置（用于 score-to-budget 映射）
budget_thresholds:
  high_score: 0.75      # ≥ 此分数 → deep budget
  medium_score: 0.50    # ≥ 此分数 → normal budget
  # < 0.50 → tiny budget

# 预算细节（映射 _select_budget 中的参数）
budget_profiles:
  tiny:
    budget_level: "tiny"
    time_ms: 500
    max_tokens: 256
    max_parallel: 1
    evidence_allowed: false
    max_tool_calls: 0
  
  normal:
    budget_level: "normal"
    time_ms: 1500
    max_tokens: 512
    max_parallel: 2
    evidence_allowed: true
    max_tool_calls: 1
  
  deep:
    budget_level: "deep"
    time_ms: 3000
    max_tokens: 1024
    max_parallel: 4
    evidence_allowed: true
    max_tool_calls: 3

scene_policies:
  dialogue:
    deliver_threshold: 0.50
    sink_threshold: -1.0
    default_action: "deliver"
    default_model_tier: "low"
    default_response_policy: "respond_now"
    dedup_window_sec: 20
    max_reasons: 5

  group:
    deliver_threshold: 0.60
    sink_threshold: 0.30
    default_action: "sink"
    default_model_tier: "low"
    default_response_policy: "defer"
    dedup_window_sec: 30
    max_reasons: 5

  system:
    deliver_threshold: 999
    sink_threshold: 0
    default_action: "sink"
    default_model_tier: null
    default_response_policy: null
    dedup_window_sec: 5
    max_reasons: 3

  tool_call:
    deliver_threshold: 0.50
    sink_threshold: 0.10
    default_action: "deliver"
    default_model_tier: null
    default_response_policy: null
    dedup_window_sec: 10
    max_reasons: 3

  tool_result:
    deliver_threshold: 0.90
    sink_threshold: 0.10
    default_action: "sink"
    default_model_tier: null
    default_response_policy: null
    dedup_window_sec: 10
    max_reasons: 3

rules:
  dialogue:
    weights:
      base: 0.10
      mention: 0.40
      question_mark: 0.15
      long_text: 0.10
    keywords:
      urgent: 0.30
      error: 0.25
      help: 0.15
    long_text_len: 300

  group:
    weights:
      base: 0.05
      mention: 0.60
      whitelist_actor: 0.25
    sample_rate: 0.02
    whitelist_actors: []

  system:
    weights:
      base: 0.0

drop_escalation:
  burst_window_sec: 10
  burst_count_threshold: 20
  consecutive_threshold: 8
  cooldown_suggest_sec: 15

overrides:
  emergency_mode: false
  force_low_model: false
  drop_sessions: []
  deliver_sessions: ["demo"]
  drop_actors: []
  deliver_actors: []
